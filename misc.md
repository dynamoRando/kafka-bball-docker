
Some general ksql objects that may be of use are below.

Create a stream for teams:

```
CREATE STREAM SK_TEAM AS SELECT
  S_TEAM.AFTER->ID ID,
  S_TEAM.AFTER->NAME NAME
FROM S_TEAM S_TEAM
PARTITION BY S_TEAM.AFTER->ID
EMIT CHANGES;
```

Create a filtered stream for only active games:

```
CREATE STREAM S_ACTIVE_GAME AS SELECT ID, AWAY_TEAM_ID, HOME_TEAM_ID, QUARTER, CLOCK_IN_SECONDS, CURRENT_POSSESSION_TEAM_ID, AWAY_TEAM_SCORE, HOME_TEAM_SCORE FROM SK_GAME WHERE IS_ACTIVE=1 EMIT CHANGES;
```

Create a key'd stream for active games for the away team:

```
CREATE STREAM SK_AWAY_TEAM_ACTIVE_GAME AS SELECT AWAY_TEAM_ID, HOME_TEAM_ID, QUARTER, CLOCK_IN_SECONDS, CURRENT_POSSESSION_TEAM_ID, AWAY_TEAM_SCORE, HOME_TEAM_SCORE FROM S_ACTIVE_GAME PARTITION BY AWAY_TEAM_ID;
```

And the same for the home teams: 

```
CREATE STREAM SK_HOME_TEAM_ACTIVE_GAME AS SELECT AWAY_TEAM_ID, HOME_TEAM_ID, QUARTER, CLOCK_IN_SECONDS, CURRENT_POSSESSION_TEAM_ID, AWAY_TEAM_SCORE, HOME_TEAM_SCORE FROM S_ACTIVE_GAME PARTITION BY HOME_TEAM_ID;
```

Creating backing tables for re-key'd items:

```
CREATE TABLE TK_AWAY_TEAM_ACTIVE_GAME (AWAY_TEAM_ID BIGINT PRIMARY KEY, HOME_TEAM_ID BIGINT, QUARTER BIGINT, CLOCK_IN_SECONDS BIGINT, CURRENT_POSSESSION_TEAM_ID BIGINT, AWAY_TEAM_SCORE BIGINT, HOME_TEAM_SCORE BIGINT) WITH (KAFKA_TOPIC='SK_AWAY_TEAM_ACTIVE_GAME', VALUE_FORMAT='AVRO');

CREATE TABLE TK_HOME_TEAM_ACTIVE_GAME (AWAY_TEAM_ID BIGINT, HOME_TEAM_ID BIGINT PRIMARY KEY, QUARTER BIGINT, CLOCK_IN_SECONDS BIGINT, CURRENT_POSSESSION_TEAM_ID BIGINT, AWAY_TEAM_SCORE BIGINT, HOME_TEAM_SCORE BIGINT) WITH (KAFKA_TOPIC='SK_HOME_TEAM_ACTIVE_GAME', VALUE_FORMAT='AVRO');
```

Creating intermediate tables for blending data:

```
CREATE TABLE TI_AWAY_TEAM_GAME AS SELECT G.ID, G.AWAY_TEAM_ID, G.HOME_TEAM_ID, A.NAME AWAY_TEAM,  G.QUARTER, G.CLOCK_IN_SECONDS, G.CURRENT_POSSESSION_TEAM_ID, G.AWAY_TEAM_SCORE, G.HOME_TEAM_SCORE, G.IS_ACTIVE FROM T_GAME G INNER JOIN T_TEAM A ON G.AWAY_TEAM_ID = A.ID;

CREATE TABLE T_TEAM_NAME_GAME AS SELECT G.G_ID, G.AWAY_TEAM, H.NAME HOME_TEAM, G.QUARTER, G.CLOCK_IN_SECONDS, G.CURRENT_POSSESSION_TEAM_ID, G.AWAY_TEAM_SCORE, G.HOME_TEAM_SCORE, G.IS_ACTIVE FROM TI_AWAY_TEAM_GAME G INNER JOIN T_TEAM H ON G.HOME_TEAM_ID = H.ID;
```

Creating backing objects for GAME_LOG:

```
CREATE STREAM S_GAME_LOG WITH (KAFKA_TOPIC='bball.bball.GAME_LOG', value_format='avro');

CREATE STREAM SK_GAME_LOG AS SELECT
  S_GAME_LOG.AFTER->ID ID,
  S_GAME_LOG.AFTER->PLAYER_ID PLAYER_ID,
  S_GAME_LOG.AFTER->GAME_ID GAME_ID,
  S_GAME_LOG.AFTER->QUARTER QUARTER,
  S_GAME_LOG.AFTER->CLOCK_IN_SECONDS CLOCK_IN_SECONDS,
  S_GAME_LOG.AFTER->POINTS POINTS
FROM S_GAME_LOG S_GAME_LOG
PARTITION BY S_GAME_LOG.AFTER->ID
EMIT CHANGES;

CREATE TABLE T_GAME_LOG (ID BIGINT PRIMARY KEY, PLAYER_ID BIGINT, GAME_ID BIGINT, QUARTER BIGINT, CLOCK_IN_SECONDS BIGINT, POINTS BIGINT) WITH (KAFKA_TOPIC='SK_GAME_LOG', VALUE_FORMAT='AVRO');
```

Creating backing objects for PLAYER:

```
CREATE STREAM S_PLAYER WITH (KAFKA_TOPIC='bball.bball.PLAYER', VALUE_FORMAT='AVRO');

CREATE STREAM SK_PLAYER AS SELECT
  S_PLAYER.AFTER->ID ID,
  S_PLAYER.AFTER->TEAM_ID TEAM_ID,
  S_PLAYER.AFTER->NAME NAME
FROM S_PLAYER S_PLAYER
PARTITION BY S_PLAYER.AFTER->ID
EMIT CHANGES;

CREATE TABLE T_PLAYER (ID BIGINT PRIMARY KEY, TEAM_ID BIGINT, NAME VARCHAR) WITH (KAFKA_TOPIC='SK_PLAYER', VALUE_FORMAT='AVRO');
```
